<div class="rill-icons-vertical" id="rillIconsBar">

  <!-- Citation (NEW SVG) -->
  <button class="rill-icon is-chapter" type="button" data-act="cite" aria-label="Citation">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 310 310" aria-hidden="true">
      <path d="M70.62 54.59 20 155.84v101.25h101.25V155.84H70.62l50.63-101.25zM290 52.91h-50.62l-50.63 101.25v101.25H290V154.16h-50.62z" fill="#FFF"></path>
    </svg>
  </button>

  <!-- Share -->
  <button class="rill-icon" type="button" data-act="share" aria-label="Share">
   <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-share-fill" viewBox="0 0 16 16">
  <path d="M11 2.5a2.5 2.5 0 1 1 .603 1.628l-6.718 3.12a2.5 2.5 0 0 1 0 1.504l6.718 3.12a2.5 2.5 0 1 1-.488.876l-6.718-3.12a2.5 2.5 0 1 1 0-3.256l6.718-3.12A2.5 2.5 0 0 1 11 2.5"/>
</svg>
  </button>

  <!-- Email -->
  <a class="rill-icon" href="#" data-act="email" aria-label="Email">
    <svg viewBox="0 0 24 24"><path d="M20 4H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2zm0 4-8 5L4 8V6l8 5 8-5v2z"/></svg>
  </a>

  <!-- Facebook -->
  <a class="rill-icon" href="#" data-act="facebook" aria-label="Facebook">
    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-facebook" viewBox="0 0 16 16">
  <path d="M16 8.049c0-4.446-3.582-8.05-8-8.05C3.58 0-.002 3.603-.002 8.05c0 4.017 2.926 7.347 6.75 7.951v-5.625h-2.03V8.05H6.75V6.275c0-2.017 1.195-3.131 3.022-3.131.876 0 1.791.157 1.791.157v1.98h-1.009c-.993 0-1.303.621-1.303 1.258v1.51h2.218l-.354 2.326H9.25V16c3.824-.604 6.75-3.934 6.75-7.951"/>
</svg>
  </a>

  <!-- X -->
  <a class="rill-icon" href="#" data-act="x" aria-label="X">
    <svg viewBox="0 0 24 24"><path d="M18.9 2H22l-6.8 7.8L23 22h-6.8l-5.3-6.5L5 22H2l7.3-8.4L1 2h6.9l4.8 6L18.9 2zm-1.2 18h1.7L7.1 3.9H5.3L17.7 20z"/></svg>
  </a>
  

<!-- LinkedIn -->
<a class="rill-icon" href="#" data-act="linkedin" aria-label="LinkedIn">
  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-linkedin" viewBox="0 0 16 16">
  <path d="M0 1.146C0 .513.526 0 1.175 0h13.65C15.474 0 16 .513 16 1.146v13.708c0 .633-.526 1.146-1.175 1.146H1.175C.526 16 0 15.487 0 14.854zm4.943 12.248V6.169H2.542v7.225zm-1.2-8.212c.837 0 1.358-.554 1.358-1.248-.015-.709-.52-1.248-1.342-1.248S2.4 3.226 2.4 3.934c0 .694.521 1.248 1.327 1.248zm4.908 8.212V9.359c0-.216.016-.432.08-.586.173-.431.568-.878 1.232-.878.869 0 1.216.662 1.216 1.634v3.865h2.401V9.25c0-2.22-1.184-3.252-2.764-3.252-1.274 0-1.845.7-2.165 1.193v.025h-.016l.016-.025V6.169h-2.4c.03.678 0 7.225 0 7.225z"/>
</svg>
</a>

</div>

<!-- Citation dropdown (fixed on screen) -->
<div class="rill-cite-menu" id="rillCiteMenu" aria-hidden="true">
  <a href="#" data-format="bib">Download BibTeX (.bib)</a>
  <a href="#" data-format="ris">Download RIS (.ris)</a>
  <a href="#" data-format="doc">Download Word (.doc)</a>
  <a href="#" data-format="pdf">Download PDF (.pdf)</a>
</div>


<style>
  .rill-icons-vertical{
    display:flex;
    flex-direction:column;
    align-items:center;
    gap:18px;
  }

  .rill-icon{
    background:none;
    border:0;
    padding:0;
    cursor:pointer;
    display:flex;
    align-items:center;
    justify-content:center;
  }

  .rill-icon svg{
    width:32px;
    height:32px;
    fill:#ffffff;
  }

  .rill-icon:hover svg{ opacity:.85; }

  /* Dropdown: fixed + high z-index so it works at top too */
  .rill-cite-menu{
    position:fixed;
    z-index:999999;
    background:#0b2b57;
    padding:10px 12px;
    border-radius:10px;
    display:none;
    flex-direction:column;
    gap:8px;
    min-width:190px;
    box-shadow:0 12px 30px rgba(0,0,0,.22);
  }

  .rill-cite-menu.is-open{ display:flex; }

  .rill-cite-menu a{
    color:#fff;
    font-size:13px;
    text-decoration:none;
    white-space:nowrap;
  }
  .rill-cite-menu a:hover{ opacity:.85; }
</style>

<script>
(function(){
  function ready(cb){
    if (document.readyState === 'loading') document.addEventListener('DOMContentLoaded', cb);
    else cb();
  }

  function getPostId(){
    const m = document.body.className.match(/postid-(\d+)/);
    return m ? m[1] : null;
  }

  function popup(url){
    window.open(url,'_blank','noopener,noreferrer,width=640,height=520');
  }

  ready(function(){
    const wrap = document.getElementById('rillIconsBar');
    const menu = document.getElementById('rillCiteMenu');
    if (!wrap || !menu) return;

    const postId = getPostId();

    function closeMenu(){
      menu.classList.remove('is-open');
      menu.setAttribute('aria-hidden','true');
    }

    function openMenuNear(el){
      const r = el.getBoundingClientRect();
      // open to the LEFT of the bar
      const top = Math.max(12, Math.min(window.innerHeight - 120, r.top));
      const left = Math.max(12, r.left - 210);

      menu.style.top = top + 'px';
      menu.style.left = left + 'px';
      menu.classList.add('is-open');
      menu.setAttribute('aria-hidden','false');
    }

    // Capture mode: catches clicks even if something overlays or stops bubbling
    document.addEventListener('click', function(e){
      const inWrap = wrap.contains(e.target);
      const inMenu = menu.contains(e.target);

      if (!inWrap && !inMenu) {
        closeMenu();
        return;
      }

      // Menu item click
      const fmtLink = e.target.closest('#rillCiteMenu [data-format]');
      if (fmtLink) {
        e.preventDefault();
        if (!postId) return;
        const fmt = fmtLink.getAttribute('data-format');
        closeMenu();
        location.href = '/?rill_cite=' + postId + '&rill_cite_format=' + fmt;
        return;
      }

      // Icon click
      const btn = e.target.closest('#rillIconsBar [data-act]');
      if (!btn) return;

      const act = btn.getAttribute('data-act');
      const url = location.href;
      const title = document.title;

      if (act === 'cite') {
        e.preventDefault();
        if (menu.classList.contains('is-open')) closeMenu();
        else openMenuNear(btn);
        return;
      }

      // any other action closes the menu
      closeMenu();

      if (act === 'share') {
        e.preventDefault();
        if (navigator.share) navigator.share({ title, url });
        else popup('https://twitter.com/intent/tweet?url=' + encodeURIComponent(url));
      }

      if (act === 'email') {
        e.preventDefault();
        location.href = 'mailto:?subject=' + encodeURIComponent(title) + '&body=' + encodeURIComponent(url);
      }

      if (act === 'facebook') {
        e.preventDefault();
        popup('https://www.facebook.com/sharer/sharer.php?u=' + encodeURIComponent(url));
      }

      if (act === 'x') {
        e.preventDefault();
        popup('https://twitter.com/intent/tweet?url=' + encodeURIComponent(url));
      }
      if (act === 'linkedin') {
  e.preventDefault();
  popup('https://www.linkedin.com/sharing/share-offsite/?url=' + encodeURIComponent(url));
}


      if (act === 'pdf') {
        e.preventDefault();
        if (!postId) return;
        location.href = '/?rill_chapter_download=' + postId;
      }
    }, true);

    // Close on scroll so it never feels “stuck”
    window.addEventListener('scroll', closeMenu, { passive:true });
    window.addEventListener('resize', closeMenu);
  });
})();
</script>
